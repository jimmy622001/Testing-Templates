# architecture-test-config.yml
# Configuration file for architecture-specific testing

# General Configuration
project_name: "Testing Templates"
primary_region: "eu-west-2"    # London
failover_region: "eu-west-1"   # Ireland

# Environments
environments:
  dev:
    account_id: "123456789012"  # Placeholder - replace with actual value
    vpc_id_primary: "vpc-dev12345"
    vpc_id_failover: "vpc-dev67890"
    suffix: "-dev"
  stage:
    account_id: "123456789012"  # Placeholder - replace with actual value
    vpc_id_primary: "vpc-stage12345"
    vpc_id_failover: "vpc-stage67890"
    suffix: "-stage"
  prod:
    account_id: "123456789012"  # Placeholder - replace with actual value
    vpc_id_primary: "vpc-prod12345"
    vpc_id_failover: "vpc-prod67890"
    suffix: "-prod"

# Load Balancer Configuration
load_balancers:
  application_load_balancer:
    name_template: "alb-{environment}"
    primary_region: true
    failover_region: true
    target_groups:
      - name_template: "tg-web-{environment}"
        path: "/api/health"
        expected_response: "healthy"
      - name_template: "tg-api-{environment}"
        path: "/health"
        expected_response: "ok"
  network_load_balancer:
    name_template: "nlb-{environment}"
    primary_region: true
    failover_region: true
    target_groups:
      - name_template: "tg-tcp-{environment}"
        port: 443
        protocol: "TCP"

# Container Services
container_services:
  ecs:
    cluster_name_template: "ecs-cluster-{environment}"
    primary_region: true
    failover_region: true
    services:
      - name_template: "web-service-{environment}"
        desired_count: 2
        max_count: 4
        cpu: 256
        memory: 512
      - name_template: "api-service-{environment}"
        desired_count: 2
        max_count: 4
        cpu: 512
        memory: 1024
  eks:
    cluster_name_template: "eks-cluster-{environment}"
    primary_region: true
    failover_region: false  # Only in primary region
    node_groups:
      - name_template: "ng-standard-{environment}"
        desired_size: 2
        min_size: 1
        max_size: 4
      - name_template: "ng-spot-{environment}"
        desired_size: 2
        min_size: 1
        max_size: 4

# Database Configuration
databases:
  aurora:
    cluster_id_template: "aurora-cluster-{environment}"
    primary_region: true
    failover_region: true
    instance_type: "db.r5.large"
    reader_instances: 1
    backup_retention: 7
    endpoints:
      writer: "aurora-cluster-{environment}.cluster-xxxxxxxxxx.{region}.rds.amazonaws.com"
      reader: "aurora-cluster-{environment}.cluster-ro-xxxxxxxxxx.{region}.rds.amazonaws.com"
    test_database: "test_db"
    test_table: "test_table"

# Storage Configuration
storage:
  s3:
    buckets:
      - name_template: "data-{environment}-{account_id}"
        primary_region: true
        failover_region: false
        lifecycle_rules: true
        versioning: true
        replication:
          enabled: true
          destination_bucket: "data-{environment}-{account_id}-replica"
          destination_region: "{failover_region}"
      - name_template: "logs-{environment}-{account_id}"
        primary_region: true
        failover_region: true
        lifecycle_rules: true
        versioning: false

# Security Services
security:
  secrets_manager:
    secrets:
      - name_template: "/app/{environment}/database"
        primary_region: true
        failover_region: true
        rotation_days: 30
      - name_template: "/app/{environment}/api-keys"
        primary_region: true
        failover_region: true
        rotation_days: 90
  waf:
    web_acl_name_template: "web-acl-{environment}"
    primary_region: true
    failover_region: true
    rules:
      - name: "rate-limit"
        limit: 100
      - name: "geo-block"
        countries: ["GB", "IE"]  # UK and Ireland
  private_ca:
    ca_name_template: "private-ca-{environment}"
    primary_region: true
    failover_region: false  # Only in primary region
    validity_days: 365

# Network Configuration
networking:
  vpc:
    name_template: "vpc-{environment}"
    primary_region:
      cidr: "10.0.0.0/16"
      subnets:
        public:
          - cidr: "10.0.0.0/24"
          - cidr: "10.0.1.0/24"
        private:
          - cidr: "10.0.2.0/24"
          - cidr: "10.0.3.0/24"
        database:
          - cidr: "10.0.4.0/24"
          - cidr: "10.0.5.0/24"
    failover_region:
      cidr: "10.1.0.0/16"
      subnets:
        public:
          - cidr: "10.1.0.0/24"
          - cidr: "10.1.1.0/24"
        private:
          - cidr: "10.1.2.0/24"
          - cidr: "10.1.3.0/24"
        database:
          - cidr: "10.1.4.0/24"
          - cidr: "10.1.5.0/24"
  transit_gateway:
    name_template: "tgw-{environment}"
    primary_region: true
    failover_region: true
    attachments:
      - vpc_name: "vpc-{environment}"
      - vpc_name: "vpc-shared-{environment}"
  nat_gateway:
    name_template: "nat-{environment}"
    primary_region: true
    failover_region: true
    count: 2
  endpoints:
    services:
      - "s3"
      - "dynamodb"
      - "secretsmanager"
    primary_region: true
    failover_region: true

# Monitoring & Logging
monitoring:
  cloudwatch:
    alarms:
      - name_template: "cpu-high-{environment}"
        threshold: 80
      - name_template: "memory-high-{environment}"
        threshold: 80
    primary_region: true
    failover_region: true
  aws_config:
    rules:
      - "ENCRYPTED_VOLUMES"
      - "S3_BUCKET_PUBLIC_READ_PROHIBITED"
    primary_region: true
    failover_region: true
  cloudtrail:
    trail_name_template: "management-{environment}"
    s3_bucket_template: "cloudtrail-logs-{environment}-{account_id}"
    primary_region: true
    failover_region: true

# Integration Test Scenarios
integration_scenarios:
  web_application_flow:
    primary_region:
      entry_point: "https://alb-{environment}-{account_id}.{primary_region}.elb.amazonaws.com/api/test"
      expected_latency_ms: 300
    failover_region:
      entry_point: "https://alb-{environment}-{account_id}.{failover_region}.elb.amazonaws.com/api/test"
      expected_latency_ms: 500
  data_processing_flow:
    primary_region:
      source_bucket: "data-{environment}-{account_id}"
      destination_bucket: "processed-data-{environment}-{account_id}"
    failover_region:
      source_bucket: "data-{environment}-{account_id}-replica"
      destination_bucket: "processed-data-{environment}-{account_id}-replica"
    test_file: "test-data.json"
    expected_processing_time_sec: 60
  failover_testing:
    enabled: true
    primary_to_failover_max_seconds: 300
    failback_max_seconds: 600

# Test Users and Roles
test_access:
  users:
    - username: "test-user-readonly"
      permissions: "readonly"
    - username: "test-user-admin"
      permissions: "admin"