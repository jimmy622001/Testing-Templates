# architecture-test-config.yml

# General Configuration
project_name: "Testing Templates"
primary_region: "eu-west-2"  # Primary AWS region - London
failover_region: "eu-west-1"  # Failover AWS region - Ireland

# Environments
environments:
  dev:
    account_id: "123456789012"
    vpc_id:
      primary: "vpc-dev12345"
      failover: "vpc-dev67890"
    suffix: "-dev"
  stage:
    account_id: "234567890123"
    vpc_id:
      primary: "vpc-stage12345"
      failover: "vpc-stage67890"
    suffix: "-stage"
  prod:
    account_id: "345678901234"
    vpc_id:
      primary: "vpc-prod12345"
      failover: "vpc-prod67890"
    suffix: "-prod"

# Load Balancer Configuration
load_balancers:
  application_load_balancer:
    name_template: "alb-{environment}"
    dns_template: "alb-{environment}-{account_id}.{region}.elb.amazonaws.com"
    target_groups:
      - name_template: "tg-web-{environment}"
        path: "/api/health"
        expected_response: "healthy"
        health_check_path: "/health"
        health_check_port: "80"
        health_threshold: 2
        unhealthy_threshold: 2
      - name_template: "tg-api-{environment}"
        path: "/health"
        expected_response: "ok"
        health_check_path: "/health"
        health_check_port: "80"
        health_threshold: 2
        unhealthy_threshold: 2
  network_load_balancer:
    name_template: "nlb-{environment}"
    dns_template: "nlb-{environment}-{account_id}.{region}.elb.amazonaws.com"
    target_groups:
      - name_template: "tg-tcp-{environment}"
        port: 443
        protocol: "TCP"
        health_check_port: "443"
        health_threshold: 2
        unhealthy_threshold: 2

# Container Services
container_services:
  ecs:
    cluster_name_template: "ecs-cluster-{environment}"
    services:
      - name_template: "web-service-{environment}"
        desired_count: 2
        max_count: 4
        cpu: 256
        memory: 512
        port: 80
        health_check_path: "/health"
      - name_template: "api-service-{environment}"
        desired_count: 2
        max_count: 4
        cpu: 512
        memory: 1024
        port: 80
        health_check_path: "/health"
  eks:
    cluster_name_template: "eks-cluster-{environment}"
    version: "1.28"
    node_groups:
      - name_template: "ng-standard-{environment}"
        desired_size: 2
        min_size: 1
        max_size: 4
        instance_type: "t3.medium"
      - name_template: "ng-spot-{environment}"
        desired_size: 2
        min_size: 1
        max_size: 4
        instance_type: "t3.medium"
        capacity_type: "SPOT"

# Database Configuration
databases:
  aurora:
    cluster_id_template: "aurora-cluster-{environment}"
    instance_type: "db.r5.large"
    reader_instances: 1
    backup_retention: 7
    engine: "aurora-mysql"
    engine_version: "5.7"
    endpoints:
      writer_template: "aurora-cluster-{environment}.cluster-xxxxxxxxxx.{region}.rds.amazonaws.com"
      reader_template: "aurora-cluster-{environment}.cluster-ro-xxxxxxxxxx.{region}.rds.amazonaws.com"
    test_database: "test_db"
    test_table: "test_table"
    test_user: "test_user"

# Storage Configuration
storage:
  s3:
    buckets:
      - name_template: "data-{environment}-{region}-{account_id}"
        lifecycle_rules: true
        versioning: true
        replication:
          enabled: true
          destination_template: "data-{environment}-{failover_region}-{account_id}"
      - name_template: "logs-{environment}-{region}-{account_id}"
        lifecycle_rules: true
        versioning: false

# Security Services
security:
  secrets_manager:
    secrets:
      - name_template: "/app/{environment}/database"
        rotation_days: 30
      - name_template: "/app/{environment}/api-keys"
        rotation_days: 90
  waf:
    web_acl_name_template: "web-acl-{environment}"
    rules:
      - name: "rate-limit"
        limit: 100
      - name: "geo-block"
        countries: ["GB", "IE", "FR", "DE"]
  private_ca:
    ca_name_template: "private-ca-{environment}"
    validity_days: 365

# Network Configuration
networking:
  vpc:
    primary:
      name_template: "vpc-{environment}-primary"
      cidr: "10.0.0.0/16"
      subnets:
        public:
          - cidr: "10.0.0.0/24"
            az: "{region}a"
          - cidr: "10.0.1.0/24"
            az: "{region}b"
        private:
          - cidr: "10.0.2.0/24"
            az: "{region}a"
          - cidr: "10.0.3.0/24"
            az: "{region}b"
        database:
          - cidr: "10.0.4.0/24"
            az: "{region}a"
          - cidr: "10.0.5.0/24"
            az: "{region}b"
    failover:
      name_template: "vpc-{environment}-failover"
      cidr: "10.1.0.0/16"
      subnets:
        public:
          - cidr: "10.1.0.0/24"
            az: "{region}a"
          - cidr: "10.1.1.0/24"
            az: "{region}b"
        private:
          - cidr: "10.1.2.0/24"
            az: "{region}a"
          - cidr: "10.1.3.0/24"
            az: "{region}b"
        database:
          - cidr: "10.1.4.0/24"
            az: "{region}a"
          - cidr: "10.1.5.0/24"
            az: "{region}b"
  transit_gateway:
    name_template: "tgw-{environment}"
    attachments:
      - vpc_name: "vpc-{environment}-primary"
      - vpc_name: "vpc-{environment}-failover"
  nat_gateway:
    name_template: "nat-{environment}"
    count: 2
  endpoints:
    services:
      - "s3"
      - "dynamodb"
      - "secretsmanager"

# Monitoring & Logging
monitoring:
  cloudwatch:
    alarms:
      - name_template: "cpu-high-{environment}"
        threshold: 80
        period: 300
        evaluation_periods: 2
      - name_template: "memory-high-{environment}"
        threshold: 80
        period: 300
        evaluation_periods: 2
    dashboards:
      - name_template: "services-dashboard-{environment}"
        widgets:
          - title: "CPU Utilization"
            metrics:
              - "AWS/EC2:CPUUtilization"
          - title: "Memory Utilization"
            metrics:
              - "CWAgent:mem_used_percent"
  aws_config:
    rules:
      - "ENCRYPTED_VOLUMES"
      - "S3_BUCKET_PUBLIC_READ_PROHIBITED"
      - "S3_BUCKET_VERSIONING_ENABLED"
  cloudtrail:
    trail_name_template: "management-{environment}"
    s3_bucket_template: "cloudtrail-logs-{environment}-{region}-{account_id}"
    multi_region: true

# Integration Test Scenarios
integration_scenarios:
  web_application_flow:
    entry_point_template: "https://alb-{environment}-{account_id}.{region}.elb.amazonaws.com/api/test"
    expected_latency_ms: 300
    test_user: "test-user@example.com"
    test_password: "reference to secret in Secrets Manager"
  data_processing_flow:
    source_bucket_template: "data-{environment}-{region}-{account_id}"
    destination_bucket_template: "processed-data-{environment}-{region}-{account_id}"
    test_file: "test-data.json"
    expected_processing_time_sec: 60
  failover_test:
    primary_endpoint_template: "https://alb-{environment}-{account_id}.{primary_region}.elb.amazonaws.com/api/health"
    failover_endpoint_template: "https://alb-{environment}-{account_id}.{failover_region}.elb.amazonaws.com/api/health"
    expected_response: "healthy"

# Test Users and Roles
test_access:
  users:
    - username_template: "test-user-readonly-{environment}"
      permissions: "readonly"
    - username_template: "test-user-admin-{environment}"
      permissions: "admin"
  roles:
    - name_template: "test-role-{environment}"
      assume_service: "ec2.amazonaws.com"